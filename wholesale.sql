-- View: wholesale_inventory
CREATE ALGORITHM=UNDEFINED DEFINER=`lizeth`@`%` SQL SECURITY DEFINER VIEW `wholesale_inventory` AS select `ws`.`id` AS `id`,`ws`.`metrc_tag` AS `metrc_tag`,`h`.`harvest_id` AS `harvest_id`,`ws`.`strain_id` AS `strain_id`,`h`.`date` AS `harvest_date`,`h`.`week_num` AS `harvest_week`,`h`.`year_num` AS `harvest_year`,`h`.`year_week` AS `harvest_year_week`,`h`.`license_id` AS `license_id`,`h`.`crop_name` AS `crop`,`c`.`name` AS `category`,`ct`.`name` AS `category_type`,`ws`.`product_id` AS `product_size`,NULL AS `color`,NULL AS `grade`,`pacstone`.`uom`.`name` AS `uom`,`ws`.`quantity` AS `quantity`,`l`.`name` AS `location`,if((`ws`.`action` = 'Packed'),'Yes','No') AS `packed`,if((`ws`.`stage_id` = 'Transfer'),'Transfer','Inventory') AS `stage` from (((((`wholesale` `ws` left join `product_sku`.`category_type` `ct` on((`ws`.`category_type_id` = convert(`ct`.`id` using utf8mb4)))) left join `product_sku`.`category` `c` on((`ws`.`category_id` = `c`.`id`))) left join `cultivation`.`harvesting_ref` `h` on((`ws`.`harvesting_id` = `h`.`id`))) left join `pacstone`.`uom` on((`ws`.`uom_id` = convert(`pacstone`.`uom`.`id` using utf8mb4)))) left join `pacstone`.`location` `l` on((`ws`.`location_id` = convert(`l`.`id` using utf8mb4)))) where (`ws`.`status` = 'active') union select `wpt`.`id` AS `id`,`wpt`.`metrc_id` AS `metrc_id`,`wpt`.`harvest_id` AS `harvest_id`,`wpt`.`strain` AS `strain`,`h`.`date` AS `date`,`h`.`week_num` AS `week_num`,`h`.`year_num` AS `year_num`,`h`.`year_week` AS `year_week`,`h`.`license_id` AS `license_id`,`h`.`crop_name` AS `crop_name`,`c`.`name` AS `name`,`ct`.`name` AS `name`,`wpt`.`size` AS `size`,`wpt`.`color` AS `color`,`wpt`.`grade` AS `grade`,NULL AS `Pound`,`wpt`.`weight` AS `weight`,`l`.`name` AS `name`,if((`wpt`.`ready` = 'Packed'),'Yes','No') AS `packed`,'Wholesale Packing' AS `stage` from ((((`wholesale_packing_temp` `wpt` left join `product_sku`.`category_type` `ct` on((`wpt`.`category_type` = convert(`ct`.`id` using utf8mb4)))) left join `product_sku`.`category` `c` on((`wpt`.`category` = `c`.`id`))) left join `cultivation`.`harvesting_ref` `h` on((`wpt`.`harvest_id` = `h`.`harvest_id`))) left join `pacstone`.`location` `l` on((`wpt`.`location_id` = convert(`l`.`id` using utf8mb4)))) where (`wpt`.`status` = 'active');

-- View: wholesale_sold
CREATE ALGORITHM=UNDEFINED DEFINER=`lizeth`@`%` SQL SECURITY DEFINER VIEW `wholesale_sold` AS select `w`.`unique_id` AS `order_uid`,`c`.`name` AS `customer`,`w`.`date` AS `order_date`,cast(`w`.`pickup_date` as date) AS `pickup_date`,week(`w`.`pickup_date`,0) AS `pickup_week`,year(`w`.`pickup_date`) AS `pickup_year`,concat(year(`w`.`pickup_date`),right(concat('0',week(`w`.`pickup_date`,0)),2)) AS `pickup_year_week`,`woi`.`metrc_id` AS `metrc_id`,`woi`.`weight` AS `weight`,`woi`.`strain_id` AS `strain_id`,`s`.`name` AS `strain_name`,`woi`.`harvest_id` AS `harvest_id`,`woi`.`product_category` AS `product_category`,`woi`.`product_type` AS `product_type`,`woi`.`grade` AS `grade`,`woi`.`color` AS `color`,`woi`.`unit_price` AS `unit_price`,`w`.`shipper_facility_license_number` AS `shipper_facility_license_number`,`w`.`manifest_id` AS `manifest_id`,`w`.`po_number` AS `po_number`,`woi`.`action` AS `status` from (((`wholesale_order_item` `woi` left join `wholesale_order` `w` on((`w`.`id` = `woi`.`id_sales_order`))) left join `crm`.`company_org` `c` on((`w`.`vendor_id` = convert(`c`.`id` using utf8mb4)))) left join `pacstone`.`plant_strain` `s` on((`s`.`id` = `woi`.`strain_id`))) where ((`woi`.`action` = 'Sold') or (`woi`.`action` = 'Accepted'));

